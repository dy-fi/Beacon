<!doctype html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0">
    <title>Beacon</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">

    <meta name="viewport" content="initial-scale=1.0, user-scalable=yes" =>
    <meta charset="utf-8">
    <style>
        #map {
            height: 60%;
        }
    </style>
    <!-- Google maps and geolocation APIs need to be rendered on the front end -->
    <script>
        function writeAddressName(latLng) {
            var geocoder = new google.maps.Geocoder();
            geocoder.geocode({
                    "location": latLng
                },
                function(results, status) {
                    if (status == google.maps.GeocoderStatus.OK)
                        document.getElementById("address").innerHTML = results[0].formatted_address;
                    else
                        document.getElementById("error").innerHTML += "Unable to retrieve your address" + "<br />";
                });
        }

        function geolocationSuccess(position) {
            var userLatLng = new google.maps.LatLng(position.coords.latitude, position.coords.longitude);
            // Write the formatted address
            writeAddressName(userLatLng);
            var myOptions = {
                zoom: 17,
                center: userLatLng,
                mapTypeId: google.maps.MapTypeId.ROADMAP
            };
            // MAP
            var mapObject = new google.maps.Map(document.getElementById("map"), myOptions);

            // CUSTOMIZE MARKER LATER
            new google.maps.Marker({
                map: mapObject,
                position: userLatLng
            });
            // Draw a circle around the user position to have an idea of the current localization accuracy
            var circle = new google.maps.Circle({
                center: userLatLng,
                radius: position.coords.accuracy,
                map: mapObject,
                fillColor: '#328AFF',
                fillOpacity: 0.5,
                strokeColor: '#328AFF',
                strokeOpacity: 1.0
            });
            mapObject.fitBounds(circle.getBounds());
        }

        function geolocationError(positionError) {
            document.getElementById("error").innerHTML += "Error: " + positionError.message + "<br />";
        }

        function geolocateUser() {
            // If the browser supports the Geolocation API
            if (navigator.geolocation) {
                var positionOptions = {
                    timeout: 10 * 1000 // 10 seconds
                };
                navigator.geolocation.getCurrentPosition(geolocationSuccess, geolocationError, positionOptions);
            } else {
                document.getElementById("error").innerHTML += "Your browser doesn't support the Geolocation API";
            }
        }
        window.onload = geolocateUser;

        // ADD EVENT LISTENERS


    </script>
    <!-- This makes the API info load asyncronously -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDDBzbximJbwANr5IfpsXzShPpT4FJXjDI&callback=initMap" async defer></script>
</head>

<body>

    {{> navbar}}
    {{> map}}

    <div class="col-lg-4" id="agenda">
        {{#each event}}
            <h4>Name: {{this.name}}</h4>
            <p>
                Description: {{this.description}}
                {{this.date}}
            </p></br>

        {{/each}}
    </div>
    <div class="col-lg-4" id="stops">
        {{#each event}}
            <h3>{{this.stops}}
        {{/each}}
    <div class="container">
        {{{body}}}
    </div>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
</body>

</html>
